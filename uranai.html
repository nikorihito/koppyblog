<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä»Šæ—¥ã®ãƒ‹ã‚³ãƒªå ã„</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="icon" href="https://nikorihito.github.io/koppyblog/favicon.png" type="image/png">

  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      padding: 20px;
    }

    /* å…ƒã®æ°´è‰²ãƒœã‚¿ãƒ³ */
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background-color: #4ec1f5;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      transition: background-color 0.3s;
      margin-top: 16px;
      border: none;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #38a3d1;
    }

    .btn.secondary {
      background-color: #7fd3f7;
    }
    .btn.secondary:hover {
      background-color: #5bbfe9;
    }

    #resultBox {
      margin-top: 20px;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #fafafa;
      display: inline-block;
      min-width: min(520px, 92vw);
    }

    #result {
      margin-top: 8px;
      font-size: 1.5em;
      font-weight: bold;
    }

    #meta {
      color: #6b7280;
      font-size: 0.95em;
      margin: 0;
    }

    .tag {
      display: inline-block;
      margin-top: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.9em;
      font-weight: bold;
    }
    .good { background: #e8fff1; color: #0b7a3a; }
    .ok   { background: #eaf7ff; color: #0b5d86; }
    .mid  { background: #f4f4f5; color: #3f3f46; }
    .warn { background: #fff7e6; color: #8a5a00; }
    .bad  { background: #ffecec; color: #a10000; }

    .actions {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
  </style>
</head>

<body>
  <header>
    <a href="../index.html">
      <img src="./favicon.png" alt="ã‚µã‚¤ãƒˆãƒ­ã‚´" class="logo" />
    </a>
    <h1>ã“ã£ã´ãƒ¼ã®ãƒã‚¤ã‚¯ãƒ©ã²ã¨ã‚„ã™ã¿</h1>
    <p class="subtitle">
      ã‚†ã‚‹ã£ã¨æ°—ã¾ã¾ã«ã€ãƒã‚¤ã‚¯ãƒ©ã®ã“ã¨ã‚’æ›¸ã„ã¦ã¾ã™ã€‚youtubeã®é…å¸ƒç‰©ã‚‚è¼‰ã›ã¾ã™ã€‚
    </p>
  </header>

  <main>
    <h2>ğŸ”® ä»Šæ—¥ã®ãƒ‹ã‚³ãƒªå ã„</h2>
    <p>ä»Šæ—¥ã®é‹å‹¢ã‚’å ã£ã¦ã¿ã‚ˆã†ï¼</p>

    <button id="fortuneBtn" class="btn" onclick="uranau()">å ã†ï¼</button>

    <div id="resultBox" style="display:none;" aria-live="polite">
      <p id="meta"></p>
      <span id="tag" class="tag mid">---</span>
      <div id="result"></div>

      <div class="actions">
        <button class="btn secondary" onclick="copyResult()">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
        <button class="btn secondary" onclick="resetToday()">ä»Šæ—¥ã®çµæœã‚’ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>

    <a href="./index.html" class="btn secondary">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
  </main>

  <footer>
    <p>&copy; 2025 ã“ã£ã´ãƒ¼</p>
  </footer>

  <script>
    const results = [
      { text: "è¶…ãƒ©ãƒƒã‚­ãƒ¼ï¼ğŸ‰", rank: "good", label: "å¤§å‰" },
      { text: "ã¾ã‚ã¾ã‚ã„ã„æ„Ÿã˜ğŸ˜Š", rank: "ok", label: "å‰" },
      { text: "ãµã¤ã†ã€œ", rank: "mid", label: "ä¸­å‰" },
      { text: "ã¡ã‚‡ã£ã¨æ³¨æ„âš ï¸", rank: "warn", label: "æœ«å‰" },
      { text: "ã ã‚ã‹ã‚‚â€¦ğŸ˜¢", rank: "bad", label: "å‡¶" }
    ];

    const STORAGE_KEY = "nikori_fortune_v1";

    function todayKey() {
      const d = new Date().toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" });
      const t = new Date(d);
      return `${t.getFullYear()}-${t.getMonth() + 1}-${t.getDate()}`;
    }

    function getIndexByDate(key) {
      let h = 0;
      for (let i = 0; i < key.length; i++) {
        h = (h * 31 + key.charCodeAt(i)) % 100000;
      }
      return h % results.length;
    }

    function uranau() {
      const key = todayKey();
      let index;

      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        const obj = JSON.parse(saved);
        if (obj.key === key) index = obj.index;
      }

      if (index === undefined) {
        index = getIndexByDate(key);
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ key, index }));
      }

      const data = results[index];

      document.getElementById("meta").textContent = `ğŸ“… ${key} ã®é‹å‹¢`;
      document.getElementById("tag").className = `tag ${data.rank}`;
      document.getElementById("tag").textContent = data.label;
      document.getElementById("result").textContent = data.text;

      document.getElementById("resultBox").style.display = "inline-block";
      document.getElementById("fortuneBtn").textContent =
        "ã‚‚ã†ä¸€åº¦è¦‹ã‚‹ï¼ˆä»Šæ—¥ã®çµæœã¯åŒã˜ï¼‰";
    }

    function copyResult() {
      const key = todayKey();
      const saved = JSON.parse(localStorage.getItem(STORAGE_KEY));
      if (!saved) return;

      const data = results[saved.index];
      const text = `${key} ã®ãƒ‹ã‚³ãƒªå ã„ï¼š${data.label}ï¼ˆ${data.text}ï¼‰`;

      navigator.clipboard.writeText(text).then(() => {
        alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
      });
    }

    function resetToday() {
      localStorage.removeItem(STORAGE_KEY);
      document.getElementById("resultBox").style.display = "none";
      document.getElementById("fortuneBtn").textContent = "å ã†ï¼";
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä»Šæ—¥ã®çµæœã‚’å¾©å…ƒ
    window.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return;

      const obj = JSON.parse(saved);
      if (obj.key === todayKey()) {
        uranau();
      }
    });
  </script>
</body>
</html>
